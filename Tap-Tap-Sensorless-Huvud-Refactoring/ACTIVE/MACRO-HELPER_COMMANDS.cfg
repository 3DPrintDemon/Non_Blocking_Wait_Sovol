#.................................................................................................................
[gcode_macro SET_PA]
description: Sets Pressure Advance
gcode:
    #Put the following in SS filament start gcode
    #SET_PA PA=0.045 ST=0.020
	SET_PRESSURE_ADVANCE ADVANCE={{ params.get('PA', printer.configfile.config['extruder']['pressure_advance']|float) }} SMOOTH_TIME={{ params.get('ST', printer.configfile.config['extruder']['pressure_advance_smooth_time']|float) }}



#.................................................................................................................
[gcode_macro M600]
description: Call to pause
gcode:
  {% if printer.print_stats.state|lower == "printing" %}  ; Check if printing
    SAVE_GCODE_STATE NAME=STATE_M600                      ; Save current state
    RESPOND TYPE=error MSG="ALERT: M600 Called!"          ; Respond with error
    PAUSE                                                 ; Pause print
    {% for s in range(0, 30) %}                           ; Loop 30 times
        SET_LED LED=sb_leds INDEX=3 RED=1 GREEN=0 BLUE=1  
        SET_LED LED=sb_leds INDEX=2 RED=.5 GREEN=.5 BLUE=.5
        G4 P100                                           ; Wait 100ms
        SET_LED LED=sb_leds INDEX=3 RED=.5 GREEN=.5 BLUE=.5
        SET_LED LED=sb_leds INDEX=2 RED=1 GREEN=0 BLUE=1
        G4 P50                                            ; Wait 50ms
    {% endfor %}                                          ; End loop
    SET_LED LED=sb_leds RED=1 GREEN=1 BLUE=1
    RESTORE_GCODE_STATE NAME=STATE_M600                   ; Restore saved state
  {% endif %}                                             ; End printing check



#.................................................................................................................	
[gcode_macro FORCE_UP]
gcode:
    {% if printer.idle_timeout.state == "Printing" or printer.pause_resume.is_paused %} ; Check if printing or paused
        {action_respond_info("Cannot do that while printing")}                          ; If so, respond with error
      {% else %}                                                                        ; If not printing or paused, continue
        {% set MM = params.get("MM", 10)|float %}          ; Default to 10mm if no parameter is passed
        {% if printer.toolhead.homed_axes == "xyz" %}      ; If homed, just raise
            G91                                            ; Relative positioning
            G1 Z{MM} F1200                                 ; Raise by MM
            G90                                            ; Absolute positioning
          {% else %}                                       ; If not homed, force raise
            SET_KINEMATIC_POSITION Z=0                     ; Hard reset Z position to 0
            G0 Z{MM} F3600                                 ; Raise by MM
            M18 Z                                          ; Ensure status is un-homed
        {% endif %}                                        ; End homed check	
	{% endif %}                                              ; End printing check
	


#.................................................................................................................	
[gcode_macro FORCE_DOWN]
gcode:
    {% if printer.idle_timeout.state == "Printing" or printer.pause_resume.is_paused %} ; Check if printing or paused
        {action_respond_info("Cannot do that while printing")}                          ; If so, respond with error
      {% else %}                                                                        ; If not printing or paused, continue
        {% set MM = params.get("MM", 10)|float %}          ; Default to 10mm if no parameter is passed
        {% if printer.toolhead.homed_axes == "xyz" %}      ; If homed, just lower
            G91                                            ; Relative positioning
            G1 Z-{MM} F1200                                ; Lower by MM
            G90                                            ; Absolute positioning
          {% else %}                                       ; If not homed, force lower
            SET_KINEMATIC_POSITION Z=0                     ; Hard reset Z position to 0
            G0 Z-{MM} F3600                                ; Lower by MM
            M18 Z                                          ; Ensure status is un-homed
        {% endif %}                                        ; End homed check	
	{% endif %}                                              ; End printing check